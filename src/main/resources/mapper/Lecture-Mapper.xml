<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ddit.proj.mapper.LectureMapper">

	<resultMap type="com.ddit.proj.vo.LecApplyVO"
		id="LecApplyMap">
		<result property="lecaId" column="LECA_ID" />
		<result property="memNo" column="MEM_NO" />
		<result property="subCode" column="SUB_CODE" />
		<result property="lecaYr" column="LECA_YR" />
		<result property="lecaSem" column="LECA_SEM" />
		<result property="lecaNm" column="LECA_NM" />
		<result property="lecaSeCode" column="LECA_SE_CODE" />
		<result property="lecaTrg" column="LECA_TRG" />
		<result property="lecaCrd" column="LECA_CRD" />
		<result property="lecaTime" column="LECA_TIME" />
		<result property="lecaCap" column="LECA_CAP" />
		<result property="lecaDt" column="LECA_DT" />
		<result property="lecaStdCode" column="LECA_STD_CODE" />
		<result property="lecaYn" column="LECA_YN" />
		<collection property="lectureVOList" resultMap="lectureMap"></collection>
	</resultMap>

	<resultMap type="com.ddit.proj.vo.LectureVO" id="lectureMap">
		<result property="lecCode" column="LEC_CODE" />
		<result property="subCode" column="SUB_CODE" />
		<result property="lecaId" column="LECA_ID" />
		<result property="lecStatYn" column="LEC_STAT_YN" />
		<result property="lecHcnt" column="LEC_HCNT" />
		<result property="lecYn" column="LEC_YN" />
		<result property="lecDelYn" column="LEC_DEL_YN" />
		<result property="roomNo" column="ROOM_NO" />
		<result property="bldCode" column="BLD_CODE" />
		<result property="lecClsNm" column="LEC_CLS_NM" />
		<collection property="lectureDetailVO"
			resultMap="lectureDetailMap"></collection>
	</resultMap>

	<resultMap type="com.ddit.proj.vo.LectureDetailVO"
		id="lectureDetailMap">
		<result property="lecCode" column="LEC_CODE" />
		<result property="lecdWeek" column="LECD_WEEK" />
		<result property="lecdSt" column="LECD_ST" />
		<result property="lecdEt" column="LECD_ET" />
	</resultMap>

	<resultMap type="com.ddit.proj.vo.MemberVO" id="MemberMap">
		<result property="memMl" column="MEM_ML" />
		<result property="memBankCode" column="MEM_BANK_CODE" />
		<result property="memDepo" column="MEM_DEPO" />
		<result property="memPic" column="MEM_PIC" />
		<result property="memAddr2" column="MEM_ADDR2" />
		<result property="memAddr1" column="MEM_ADDR1" />
		<result property="memZip" column="MEM_ZIP" />
		<result property="memTel2" column="MEM_TEL2" />
		<result property="memTel" column="MEM_TEL" />
		<result property="memNme" column="MEM_NME" />
		<result property="memNm" column="MEM_NM" />
		<result property="memDelYn" column="MEM_DEL_YN" />
		<result property="memPass" column="MEM_PASS" />
		<result property="memNo" column="MEM_NO" />
		<result property="memBir" column="MEM_BIR" />
		<collection property="professorVO" resultMap="ProfessorMap"></collection>
		<collection property="departmentVO" resultMap="departMap"></collection>
	</resultMap>

	<resultMap type="com.ddit.proj.vo.ProfessorVO"
		id="ProfessorMap">
		<result property="memNo" column="MEM_NO" />
		<result property="depCode" column="DEP_CODE" />
		<result property="proPosYn" column="PRO_POS_YN" />
		<result property="codeProStat" column="CODE_PRO_STAT" />
	</resultMap>

	<resultMap type="com.ddit.proj.vo.DepartmentVO" id="departMap">
		<result property="memNo" column="MEM_NO" />
		<result property="depDelYn" column="DEP_DEL_YN" />
		<result property="depTel" column="DEP_TEL" />
		<result property="depCap" column="DEP_CAP" />
		<result property="depDrhf" column="DEP_DRHF" />
		<result property="depDc" column="DEP_DC" />
		<result property="depNm" column="DEP_NM" />
		<result property="colCode" column="COL_CODE" />
		<result property="depCode" column="DEP_CODE" />
	</resultMap>
	
	<resultMap type="com.ddit.proj.vo.BuildingVO" id="buildMap">
		<result property="bldCode" column="BLD_CODE" />
		<result property="colCode" column="COL_CODE" />
		<result property="bldNm" column="BLD_NM" />
		<collection property="roomVO" resultMap="roomMap"></collection>
	</resultMap>
	
	<resultMap type="com.ddit.proj.vo.RoomVO" id="roomMap">
		<result property="roomNo" column="ROOM_NO" />
		<result property="bldCode" column="BLD_CODE" />
		<result property="roomCap" column="ROOM_CAP" />
	</resultMap>
	
	<!-- 로그인 한 교수의 연도/학기 정보 불러오기 -->
	<select id="getYrsem" parameterType="String" resultType="LecApplyVO">
		SELECT distinct	b.LECA_YR, b.LECA_SEM
		FROM LEC_APPLY b
		LEFT JOIN LECTURE a
		ON b.LECA_ID = a.LECA_ID
		LEFT JOIN LECTURE_DETAIL c
		ON a.LEC_CODE = c.LEC_CODE
		where b.MEM_NO = #{memNo}
	</select>
	
	<!-- 강의정보 불러오기 -->
	<select id="listLecture" parameterType="String"
		resultMap="LecApplyMap">
		SELECT
		b.MEM_NO, b.SUB_CODE, b.LECA_YR, b.LECA_SEM, b.LECA_NM, b.LECA_SE_CODE,
		b.LECA_TRG, b.LECA_CRD, b.LECA_TIME, b.LECA_CAP, b.LECA_DT,
		b.LECA_STD_CODE, b.LECA_YN,
		a.LEC_CODE, a.SUB_CODE, a.LECA_ID, a.LEC_STAT_YN, a.LEC_HCNT, a.LEC_YN,
		a.LEC_DEL_YN, a.ROOM_NO, a.BLD_CODE, a.LEC_CLS_NM,
		c.LECD_WEEK, c.LECD_ST, c.LECD_ET
		FROM LEC_APPLY b
		LEFT JOIN LECTURE a
		ON b.LECA_ID = a.LECA_ID
		LEFT JOIN LECTURE_DETAIL c
		ON a.LEC_CODE = c.LEC_CODE
		where b.MEM_NO = #{memNo}
	</select>
	
	<!-- 강의정보 셀렉별 불러오기 
	//LecApplyVO(lecaId=null, memNo=202008P003, subCode=null, lecaYr=2023
	//, lecaSem=2, lecaNm=null, lecaSeCode=null, lecaTrg=0, lecaCrd=0, lecaTime=0, lecaCap=0, lecaDt=null, lecaStdCode=null, lecaYn=null, lectureVOList=null)
	-->
	<select id="listSelLecture" parameterType="LecApplyVO" resultMap="LecApplyMap">
		SELECT b.LECA_YR, b.LECA_SEM, b.LECA_NM, b.LECA_SE_CODE,b.LECA_TRG, b.LECA_CRD, b.LECA_TIME, b.LECA_CAP, b.LECA_DT,	b.LECA_STD_CODE, b.LECA_YN,
		a.LEC_CODE, a.SUB_CODE, a.LECA_ID, a.LEC_STAT_YN, a.LEC_HCNT, a.LEC_YN,a.LEC_DEL_YN, a.ROOM_NO, a.BLD_CODE, a.LEC_CLS_NM,
		c.LECD_WEEK, c.LECD_ST, c.LECD_ET
		FROM LEC_APPLY b LEFT JOIN LECTURE a ON(b.LECA_ID = a.LECA_ID)
                         LEFT JOIN LECTURE_DETAIL c ON (a.LEC_CODE = c.LEC_CODE)
		where b.MEM_NO = #{memNo} 
		<if test="lecaYr!=null and lecaYr!=''">
			and b.LECA_YR = #{lecaYr} and b.LECA_SEM = #{lecaSem}
		</if>
	</select>
	
	<!-- 강의실호수 건물 이름 셀렉트 옵션에 넣기   -->
	<select id="getBuildRoom" resultMap="buildMap">
		SELECT
			a.BLD_NM,
			a.BLD_CODE,
			b.ROOM_NO
		FROM BUILDING a
		LEFT JOIN ROOM b
			ON a.BLD_CODE = b.BLD_CODE
	</select>
	
	<!-- 강의실호수 건물 이름 셀렉트 옵션에 넣기   -->
	<select id="getRoomNo" parameterType="String" resultMap="buildMap">
		SELECT
			a.BLD_NM,
			a.BLD_CODE,
			b.ROOM_NO
		FROM BUILDING a
		LEFT JOIN ROOM b
			ON a.BLD_CODE = b.BLD_CODE
			where a.BLD_CODE =#{bldCode}
	</select>
	
	
	<!-- 교수 정보 불러오기 -->
	<select id="getProf" parameterType="String"
		resultMap="MemberMap">
		SELECT
		    a.MEM_NO, a.MEM_PASS, a.MEM_DEL_YN, a.MEM_NM, a.MEM_NME, a.MEM_TEL, a.MEM_TEL2,
		    a.MEM_ZIP, a.MEM_ADDR1, a.MEM_ADDR2, a.MEM_PIC, a.MEM_DEPO,
		    a.MEM_BANK_CODE, a.MEM_ML,a.MEM_BIR,
		    b.DEP_CODE, 
		    CASE
		        WHEN b.PRO_POS_YN = 'Y' THEN '학과장'
		        WHEN b.PRO_POS_YN = 'N' THEN '교수'
		        ELSE ''
		    END AS PRO_POS_YN,
		    b.CODE_PRO_STAT,
		    (SELECT c.DEP_NM
		    FROM DEPARTMENT c
		    WHERE b.DEP_CODE = c.DEP_CODE) AS DEP_NM,
		    (SELECT c.DEP_TEL
		    FROM DEPARTMENT c
		    WHERE b.DEP_CODE = c.DEP_CODE) AS DEP_TEL
		FROM MEMBER a
		INNER JOIN PROFESSOR b
		ON a.MEM_NO = b.MEM_NO
		WHERE a.MEM_NO = #{memNo}
	</select>

	<!-- 강의자료(강의게시판) -->
	<select id="listLecNotice" resultType="LecNoticeVO">
		select LECN_CODE, LEC_CODE, LECN_CATA_CODE, LECN_TTL, LECN_CON, TO_CHAR(LECN_DE, 'YYYY-MM-DD') as LECN_DE, TO_CHAR(LECN_UPDDE, 'YYYY-MM-DD') as LECN_UPDDE, FILE_ID from lec_notice
	</select>
	
	<select id="getLecNoticeVO" parameterType="String" resultType="LecNoticeVO">
		select LECN_CODE, LEC_CODE, LECN_CATA_CODE, LECN_TTL, LECN_CON, LECN_DE, LECN_UPDDE, FILE_ID from
		lec_notice where lec_code=to_number(#{lecCode})
	</select>
	
	<!-- 강의계회석 평가기준 -->
	<select id="leesCode" resultType="LecApplyVO">
	SELECT CODE_ID, CODE_NM
		FROM CODE
		WHERE GROUP_ID = 'LEES' AND CODE_YN = 'Y'
		AND GROUP_ID IN (SELECT GROUP_ID FROM GROUP_CODE WHERE GROUP_YN = 'Y')
	</select>
	
	
	
</mapper>